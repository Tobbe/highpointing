<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=ISO-8859-15" />

    <script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?sensor=false"></script>
    <style type="text/css">
        html, body, #map_canvas { margin: 0; padding: 0; height: 100% }
    </style>
    <script type="text/javascript">
    var highpoints = [
        {
            location: new google.maps.LatLng(56.065200, 13.138250),
            name: 'Magleröd, Söderåsen',
            province: 'Skåne',
            visit_order: 0
        },
        {
            location: new google.maps.LatLng(56.375567, 13.040200),
            name: 'Högalteknall',
            province: 'Halland',
            visit_order: 1
        },
        {
            location: new google.maps.LatLng(56.440850, 14.528467),
            name: 'Rävabacken',
            province: 'Blekinge',
            visit_order: 2
        },
        {
            location: new google.maps.LatLng(56.770157, 16.595883),
            name: 'Rösslösa',
            province: 'Öland',
            visit_order: 3
        },
        {
            location: new google.maps.LatLng(57.332150, 18.337100),
            name: 'Lojstahajd',
            province: 'Gotland',
            visit_order: 4
        },
        {
            location: new google.maps.LatLng(57.768217, 15.242050),
            name: 'Stenabo',
            province: 'Östergötland',
            visit_order: 5
        },
        {
            location: new google.maps.LatLng(57.500317, 14.470083),
            name: 'Tomtabacken',
            province: 'Småland',
            visit_order: 6
        },
        {
            location: new google.maps.LatLng(57.784283, 13.550367),
            name: 'Galtåsen',
            province: 'Västergötland',
            visit_order: 7
        },
        {
            location: new google.maps.LatLng(59.012633, 11.402850),
            name: 'Björnerödspiggen',
            province: 'Bohuslän',
            visit_order: 8
        },
        {
            location: new google.maps.LatLng(59.084767, 12.472117),
            name: 'Baljåsen',
            province: 'Dalslands',
            visit_order: 9
        },
        {
            location: new google.maps.LatLng(59.384100, 14.972083),
            name: 'Kilsbergen (Tomasboda)',
            province: 'Närke',
            visit_order: 10
        },
        {
            location: new google.maps.LatLng(58.790733, 16.327733),
            name: 'Skogsbyås',
            province: 'Södermanland',
            visit_order: 11
        },
        {
            location: new google.maps.LatLng(59.971100, 17.088183),
            name: 'Tallmossen',
            province: 'Uppland',
            visit_order: 12
        },
        {
            location: new google.maps.LatLng(60.095367, 14.916400),
            name: 'Fjällberget',
            province: 'Västmanland',
            visit_order: 13
        },
        {
            location: new google.maps.LatLng(60.897467, 12.742050),
            name: 'Granberget, Höljes',
            province: 'Värmland',
            visit_order: 14
        },
        {
            location: new google.maps.LatLng(60.991850, 16.131217),
            name: 'Lustigknopp',
            province: 'Gästrikland',
            visit_order: 15
        },
        {
            location: new google.maps.LatLng(61.896317, 14.807433),
            name: 'Granåsen (Garpknölen)',
            province: 'Hälsingland',
            visit_order: 16
        },
    /*
        {
            location: new google.maps.LatLng(62.120733, 12.451333),
            name: 'Storvätteshågna',
            province: 'Dalarna',
            visit_order: 17
        }, // Grövelsjön, Sweden
        {
            location: new google.maps.LatLng(62.904000, 12.453000),
            name: 'Helagsfjället',
            province: 'Härjedalen',
            visit_order: 18
        }, // Ljungdalen, Sweden
        {
            location: new google.maps.LatLng(62.467033, 15.074567),
            name: 'Myckelmyrberget',
            province: 'Medelpad',
            visit_order: 19
        },
        {
            location: new google.maps.LatLng(63.021717, 12.199417),
            name: 'Storsylen Rr 155B',
            province: 'Jämtland',
            visit_order: 20
        }, // Storulvåns fjällstation, Duved, Sverige
        {
            location: new google.maps.LatLng(64.234067, 15.933500),
            name: 'Tåsjöberget',
            province: 'Ångermanland',
            visit_order: 21
        },
        {
            location: new google.maps.LatLng(65.043200, 19.005950),
            name: 'Åmliden',
            province: 'Västerbotten',
            visit_order: 22
        },
        {
            location: new google.maps.LatLng(65.982967, 20.319133),
            name: 'Vitberget',
            province: 'Norrbotten',
            visit_order: 23
        },
        {
            location: new google.maps.LatLng(67.900900, 18.517350),
            name: 'Kebnekaise',
            province: 'Lappland',
            visit_order: 24
        }, // Nikkaluokta, Sweden
    */
    ];

    var stepDisplay;
    var map;
    var mapOptions = { mapTypeId: google.maps.MapTypeId.ROADMAP };

    function initialize() {
        var icons = new Array();

        function getMarkerImage(iconColor, iconLetter) {
            if ((typeof(iconColor)=="undefined") || (iconColor==null)) {
                iconColor = "red";
            }

            if (!icons[iconColor+iconLetter]) {
                icons[iconColor+iconLetter] = new google.maps.MarkerImage("http://www.google.com/mapfiles/marker_" + iconColor + iconLetter + ".png",
                // This marker is 32 pixels wide by 32 pixels tall.
                new google.maps.Size(32, 32),
                // The origin for this image is 0,0.
                new google.maps.Point(0,0),
                // The anchor for this image is at 16,32.
                new google.maps.Point(16, 32));
            }

            return icons[iconColor+iconLetter];
        }

        // Marker sizes are expressed as a Size of X,Y
        // where the origin of the image (0,0) is located
        // in the top left of the image.
         
        // Origins, anchor positions and coordinates of the marker
        // increase in the X direction to the right and in
        // the Y direction down.

        var iconShadow = new google.maps.MarkerImage('http://maps.google.com/mapfiles/ms/micons/msmarker.shadow.png',
            // The shadow image is larger in the horizontal dimension
            // while the position and offset are the same as for the main image.
            new google.maps.Size(59, 32),
            new google.maps.Point(0,0),
            new google.maps.Point(16, 32));
            // Shapes define the clickable region of the icon.
            // The type defines an HTML <area> element 'poly' which
            // traces out a polygon as a series of X,Y points. The final
            // coordinate closes the poly by connecting to the first
            // coordinate.
        var iconShape = {
            coord: [19,0, 24,5, 24,12, 23,13, 23,14, 20,17, 20,18, 19,19, 19,20,
                    18,21, 18,22, 17,23, 17,26, 16,27, 16,31, 14,31, 14,26, 13,25,
                    13,23, 12,22, 12,20, 10,18, 10,17, 7,14, 7,13, 6,12, 6,6, 7,5,
                    7,4, 11,0],
            type: 'poly'
        };

        var infowindow = new google.maps.InfoWindow({
            size: new google.maps.Size(150,50)
        });
       
        function createMarker(map, latlng, label, html, color, letter) {
            var contentString = '<b>'+label+'</b><br>'+html;
            var marker = new google.maps.Marker({
                position: latlng,
                map: map,
                shadow: iconShadow,
                icon: getMarkerImage(color, letter),
                shape: iconShape,
                title: label,
                zIndex: Math.round(latlng.lat()*-100000)<<5
            });

            google.maps.event.addListener(marker, 'click', function() {
                infowindow.setContent(contentString);
                infowindow.open(map, marker);
            });
            
            return marker;
        }

        map = new google.maps.Map(document.getElementById("map_canvas"), mapOptions);
        directionsService = new google.maps.DirectionsService();
        stepDisplay = new google.maps.InfoWindow();
        var marker;
        var highpointChunks = highpoints.chunk(6);
        var directionsDisplays = new Array(highpointChunks.length);
        var routesCreated = 0;

        for (var i = 0; i < highpointChunks.length; ++i) {
            directionsDisplays[i] = new google.maps.DirectionsRenderer({
                suppressMarkers: true,
                //suppressInfoWindows: false*/
            });

            directionsDisplays[i].setMap(map);

            if (i < highpointChunks.length - 1) {
                // Add the first item of the next chunk as the last item in
                // this chunk to create a continuous route
                highpointChunks[i].push(highpointChunks[i + 1][0]);
            }

            var waypnts = new Array(highpointChunks[i].length - 1);
            for (var j = 0; j < highpointChunks[i].length - 1; ++j) {
                waypnts[j] = {
                    location: highpointChunks[i][j + 1].location,
                    stopover: true
                };
            }

            var request = {
                origin: highpointChunks[i][0].location,
                waypoints: waypnts,
                destination: highpointChunks[i][highpointChunks[i].length - 1].location,
                travelMode: google.maps.DirectionsTravelMode.DRIVING
            };

            directionsService.route(request, function (i) { return function(response, status) {
                if (status == google.maps.DirectionsStatus.OK) {
                    directionsDisplays[i].setDirections(response);
                    var route = response.routes[0];
                    if (route.legs.length != highpointChunks[i].length) {
                        alert("Yor code is broken. " + highpointChunks[i].length + " legs expected. Got " + route.legs.length);
                        return;
                    }
              
                    for (var leg = 0; leg < route.legs.length; leg++) {
                        if (highpoints[highpointChunks[i][leg].visit_order].route == undefined) {
                            highpoints[highpointChunks[i][leg].visit_order].route = route.legs[leg];

                            routesCreated++;
                        }

                        if (routesCreated == highpoints.length) {
                            createMarkers();
                        }
                    }
                }
            };}(i));

            function createMarkers() {
                var totalDistance = 0;
                for (var i = 0; i < highpoints.length; ++i) {
                    var highpoint = highpoints[i];
                    createMarker(map, highpoint.location, highpoint.name,
                            "Landskap: " + highpoint.province +
                            "<br>total dist: " + totalDistance / 10000,
                            "green", character(i)
                    );
                    totalDistance += highpoint.route.distance.value;
                }
            }
        }

        function character(index) {
            return "ABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(index);
        }
    }

    google.maps.event.addDomListener(window, 'load', initialize);

    Array.prototype.chunk = function(chunkSize) {
        var newarr = new Array();

        for (var i = 0; i < this.length; i += chunkSize) {
            newarr.push(this.slice(i, i + chunkSize));
        }

        return newarr;
    }
</script>
</head>
<body>
    <div id="map_canvas"></div>
</body>
</html>
